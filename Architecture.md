# Architecture of Uperf
As stated in the [documentation](http://uperf.org/manual.html) uperf is a file based network micro benchmark utility. The goal of this document is to provide a developer with an overview of the file layout, control flow, and data structures.

## Glossary
- *strand* - uperf abstraction for process or pthread
- *flowop* - the smallest unit of work specified in a XML configuration file, including `connect`,`read`,`write`,and `disconnect`.
- *transaction* - wrapper around one or more flowops
- *group* - a set of transaction that can be executed by one or more threads
- *client* - acts a client in the client server model, also responsible for stats collection and transmitting the work to be done to the server.
- *server* - a simple daemon that receives packets from the client, keeps track of the stats of the run, and transmits stats back to the client.

# CodeMap
A brief description of the purpose of the files
## `common.[c|h]`
Functions and structures that are common to the client and server
## `delay.[c|h]`
Functions used when needing to sleep or spin wait.
## `execute.[c|h]`
A wrapper around the transactions that are specified by the user.
## `flowops.[c|h]`
Structures and enums that define the results and error generated by flowops.
## `generic.[c|h]`
Layer that sits on top of all protocols to facilitate open,send,close operations.
## `goodbye.[c|h]`
Structures and functions covering the last message from the server to the client. The purpose of the message is to transmit the collected statistics from the run to the client.
## `handshake.[c|h]`
Functions that handle the sending and receiving of the groups, transactions, and flowops.
## `hwcounter.c`
Uses `sys/systeminfo.h`, and `sysinfo` function. By default looks for `BU_cpu_clk_unhalted` and `FR_retired_x86_instr_w_excp_intr`.
## `logging.[c|h]`
Provides 6 message types, `ERROR`,`QUIT`,`ABORT`,`INFO`,`DEBUG`,`WARN`. Logs to stdout by default.
## `netstat.[c|h]`
On Linux, this parses `/proc/net/dev`.
## `numbers.[c|h]`
Utility functions to convert numbers to be human readable.
## `parse.[c|h]`
Parses the XML based configuration file
## `print.[c|h]`
Window width aware printer for run time and summary stats
## `protocol.[c|h]`
Abstraction layer that sits on top of supported protocols, allowing de-coupling of protocol implementations and the uperf benchmark harness.
## `rate.[c|h]`
Functions that will execute a supplied callback at the rate given in the function declaration.
## `stats.[c|h]`
Functions and data structures covering statistics and data collection. Collection is done in shared memory.
## `strand.[c|h]`
Abstraction layer meant to abstract threads and processes so they can both be controlled via these functions.
## `sync.[c|h]`
Functions and structures to ensure that all strands complete a transaction before moving onto the next transaction


## Data Structures
TODO
